Лабораторная работа 6: Рефакторинг и code smells

Обнаруженные проблемы качества кода (code smells)
1. Длинная функция
   · Функция process_checkout выполняет слишком много задач: парсинг, валидацию, расчёты и форматирование
2. Повторение кода
   · Множественные проверки if для валидации имеют схожую структуру
3. Волшебные числа
   · Проценты скидок (0.10, 0.20, 0.05, 0.21) и фиксированные значения (50, 10, 200, 100) разбросаны по коду
4. Вложенные условия
   · Много уровней вложенности в логике расчёта скидок
5. Отсутствие разделения ответственности
   · Одна функция занимается всеми аспектами обработки заказа
6. Жёстко закодированные строки
   · Коды купонов и сообщения об ошибках прямо в коде

Применённые рефакторинги
1. Вынесение констант
Создал константы для всех магических чисел:

· Ставки налогов и скидок
· Пороговые значения для скидок
· Коды купонов
· Сообщения об ошибках

2. Разделение на функции с единственной ответственностью
Создал отдельные функции для:

· _validate_request() - проверка входных данных
· _calculate_subtotal() - подсчёт суммы заказа
· _calculate_discount() - расчёт скидки
· _calculate_tax() - расчёт налога
· _generate_order_id() - генерация ID заказа

3. Упрощение сложных условий
Преобразовал цепочку if-elif-else в читаемый словарь для купонов с лямбда-функциями

4. Улучшение читаемости
· Расположил код в логическом порядке: проверка → расчёты → формирование результата
· Добавил docstring к функциям
· Использовал понятные имена переменных

5. Удаление дублирования
· Объединил проверки валидации в циклы
· Вынес повторяющиеся операции в отдельные функции

Результаты рефакторинга

Что стало проще:
1. Читать код - каждая функция выполняет одну понятную задачу
2. Тестировать - можно тестировать каждую часть логики отдельно
3. Изменять бизнес-правила:
   · Чтобы изменить ставку налога, нужно поменять одну константу
   · Чтобы добавить новый купон, нужно добавить одну запись в словарь
   · Чтобы изменить правила валидации, это делается в одном месте
4. Находить ошибки - стек вызовов показывает, в какой именно части логики произошла ошибка

Количественные улучшения:
· Основная функция process_checkout уменьшилась с 60+ строк до ~15 строк
· Убрано 5+ уровней вложенности
· Все числовые константы вынесены и названы

Сохранение поведения:
Все тесты проходят без изменений, поведение системы осталось прежним. Рефакторинг выполнен маленькими шагами с постоянной проверкой тестов.
